const dotenv = require('dotenv');
const { worker } = require('./worker/resender');
const { resenderQueue, addJob } = require('./queue');
const cron = require('node-cron');
const BotModel = require('./db/models/bot');
const mongoose = require('mongoose');

dotenv.config({ path: './config/config.env' });

process.setMaxListeners(0);

const producer = async () => {
  const conn = await mongoose.connect(process.env.MONGO_URI, {
    useUnifiedTopology: true,
    useNewUrlParser: true,
    useFindAndModify: false,
    useCreateIndex: true,
  });

  BotModel.find({}, (err, bots) => {
    bots.forEach(async ({ credentials, text }) => {
      await addJob(resenderQueue, { credentials, text });
    });
  });
};

const acc = {
  credentials: {
    username: 'newlove_agency',
    password: 'Polki123',
  },
  text: [
    'ðŸ¥°Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ NewLove. ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÑŽ Ð´Ð¾Ñ…Ð¾Ð´ Ð¾Ñ‚ 700$-1200$. Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÑŽ Ð½Ð° 7-12 ÑÐ°Ð¹Ñ‚Ð°Ñ…. Ð•ÑÐ»Ð¸ Ñ‚Ð²Ð¾Ñ Ð°Ð½ÐºÐµÑ‚Ð° ÐµÑÑ‚ÑŒ Ð½Ð° ÑÐ°Ð¹Ñ‚Ð°Ñ… Ð±Ñ€Ð°Ñ‡Ð½Ñ‹Ñ… Ð°Ð³ÐµÐ½Ñ‚ÑÑ‚Ð²- Ð¼Ñ‹ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶Ð¸Ð¼ Ñ‚ÐµÐ±Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð´Ð»Ñ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð°ÑÑÐ¸Ð²Ð½Ð¾Ð³Ð¾ Ð´Ð¾Ñ…Ð¾Ð´Ð°. Ð¡ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸ÐµÐ¼, ÐšÐ°Ñ€Ð¸, Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð¸Ñ‚ÐµÐ»ÑŒ Ð°Ð³ÐµÐ½Ñ‚ÑÑ‚Ð²Ð°ðŸ˜Š',
    'ðŸ¥°ðŸ˜Ð’ÐÐ˜ÐœÐÐÐ˜Ð• ÐšÐÐ¡Ð¢Ð˜ÐÐ“ðŸ¤© Ð”Ð¾Ñ…Ð¾Ð´ Ð¾Ñ‚ 2500$ ÐµÐ¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ð¾ Ð¡ÑƒÑ‚ÑŒ: ÑÐ¿ÐµÑ†Ñ‹ Ð¸Ð· Ð¡Ð¨Ð Ð²ÐºÐ»Ð°Ð´Ñ‹Ð²Ð°ÑŽÑ‚ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ñ€Ð°ÑÐºÑ€ÑƒÑ‚ÐºÑƒ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð° Ñ Ð’Ð°ÑˆÐ¸Ð¼Ð¸ Ñ„Ð¾Ñ‚Ð¾ Ð² Ð¸Ð½ÑÑ‚Ðµ (Ð¾Ñ‚ 2500$ Ð´Ð¾Ñ…Ð¾Ð´) Ð»Ð¸Ð±Ð¾ Ð¾Ð½Ð»Ð¸Ñ„Ð°Ð½Ñ (Ð¾Ñ‚ 4000$). ÐžÑ‚ Ð’Ð°Ñ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð´Ð»Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ‡ÐºÐ¸ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ 1-2 Ð´Ð½ÐµÐ¹. ÐŸÐ»ÑŽÑÑ‹: -Ð’Ñ‹ ÑÐ°Ð¼Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð¸Ñ€ÑƒÐµÑ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸ÐµÐ¼Ð»ÐµÐ¼Ð¾, Ñ‡Ñ‚Ð¾ Ð½ÐµÑ‚. - Ð¡Ð°Ð¼Ð¾Ðµ Ð²Ð°Ð¶Ð½Ð¾Ðµ, ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð·Ð¿. ÐžÑ‚ÐºÑƒÐ´Ð° Ð±ÐµÑ€ÑƒÑ‚ÑÑ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ñ Ð¸Ð½ÑÑ‚Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð° (Ñ Ð¾Ð½Ð»Ð¸Ñ„Ð°Ð½Ñ Ð²ÑÐµ Ð¸ Ñ‚Ð°Ðº ÑÑÐ½Ð¾)? ÐÐ¼ÐµÑ€Ð¸ÐºÐ°Ð½Ñ†Ñ‹ Ñ Ð½ÑƒÐ»Ñ ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚ Ð½Ð¾Ð²ÑƒÑŽ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ Ð² Ð¸Ð½ÑÑ‚Ðµ Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°Ð¼Ð¸, Ð²ÐºÐ»Ð°Ð´Ñ‹Ð²Ð°ÑŽÑ‚ Ð±Ð°ÑˆÐµÐ½Ð½Ñ‹Ðµ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ð°Ð½ÐºÐµÑ‚Ñƒ, Ð² Ñ€ÐµÐºÐ»Ð°Ð¼Ñƒ, Ð¸ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¿Ð¾ Ð¿Ð¾Ð´Ð¾Ð±Ð¸ÑŽ Ñ Ð±Ñ€Ð°Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð°Ð³ÐµÐ½Ñ‚ÑÑ‚Ð²Ð°Ð¼Ð¸ Ñ€Ð°ÑÐºÑ€ÑƒÑ‡Ð¸Ð²Ð²ÑŽÑ‚ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½ Ð½Ð° Ð´ÐµÐ½ÑŒÐ³Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ð¸Ð½ÑÑ‚Ðµ.. Ð ÐÐ¡Ð§Ð˜Ð¢ÐÐÐž Ð½Ð° Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸ÑŽ Ð¡Ð¨Ð. Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾? Ð¢Ð¾Ð³Ð´Ð° Ð¿Ñ€Ð¸ÑˆÐ»ÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ ÐºÐ°ÑÑ‚Ð¸Ð½Ð³Ð°.',
  ],
};


addJob(resenderQueue, acc);

worker.on('completed', (job) => console.log(`Completed job ${job.id} successfully finished, all messages resent`));
worker.on('failed', (job, err) => console.log(`Failed job ${job.id} with ${err}`));

console.log('Queue started at ', new Date());
cron.schedule('05 11 * * *', async () => {
  producer();
});